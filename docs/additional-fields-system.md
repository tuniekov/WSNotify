# Система дополнительных полей в vk24Config

## Общее описание

Система дополнительных полей позволяет динамически добавлять новые поля к существующим таблицам базы данных без изменения основной схемы. Конфигурация находится в файле `V:\OSPanel\home\modx28.loc\public\Extras\vk24Config\_build\configs\data.js`.

## Структура системы

### 1. gtsAPIField - Определение полей

Основная таблица, содержащая описание всех дополнительных полей:

```javascript
{
    "title": "Название поля",
    "name": "имя_поля",
    "dbtype": "тип_данных",
    "dbprecision": "точность",
    "dbnull": 0|1,
    "dbdefault": "значение_по_умолчанию",
    "dbindex": "INDEX|no",
    "after_field": "поле_после_которого_вставить",
    "rank": порядок,
    "default": "значение_по_умолчанию_для_формы",
    "field_type": "тип_поля_формы",
    "gtsapi_config": "конфигурация",
    "description": "описание",
    "modal_only": 0|1,
    "table_only": 0|1,
    "properties": "дополнительные_данные_в_json"
}
```

### 2. gtsAPIFieldGroup - Группы полей

Группировка полей по функциональному назначению:

```javascript
{
    name: "Название группы",
    from_table: "gtsAPIField",
    link_group_table: "gtsAPIFieldGroupLink",
    all: 0
}
```

### 3. gtsAPIFieldGroupLink - Связь полей с группами

Связывает конкретные поля с группами:

```javascript
{
    group_field_id: {
        key: "name",
        table: "gtsAPIFieldGroup",
        name: "Название группы"
    },
    field_id: {
        key: "name",
        table: "gtsAPIField",
        name: "имя_поля"
    }
}
```

### 4. gtsAPIFieldTable - Таблицы для добавления полей

Определяет в какие таблицы добавлять поля:

```javascript
{
    name_table: "имя_таблицы",
    add_base: 1,
    add_table: 1,
    only_text: 0,
    after_field: "поле_после_которого_добавить",
    desc: "описание"
}
```

### 5. gtsAPIFieldGroupTableLink - Связь групп с таблицами

Связывает группы полей с таблицами:

```javascript
{
    group_field_id: {
        key: "name",
        table: "gtsAPIFieldGroup",
        name: "Название группы"
    },
    table_field_id: {
        key: "name_table",
        table: "gtsAPIFieldTable",
        name_table: "имя_таблицы"
    }
}
```

## Определенные группы полей

### 1. Допполя продукта для импорта из эксель

**Таблица:** gsProductData

**Поля:**
- `sech_id` (tinyint) - Сечение (Прямоуголка/Кругляк)
- `excel_name` (varchar 255) - Имя эксель
- `excel_mat_name` (varchar 100) - Имя материала
- `modx_pl_class_id` (int) - ID детали modx.pl (для camduct, ставить для корпуса)
- `flanec` (tinyint) - Фланец (boolean)

### 2. Допполя в таблицу gsParam для импорта из эксель

**Таблица:** gsParam

**Поля:**
- `excel_pryam` (text) - Excel pryam
- `excel_krug` (text) - Excel круг

### 3. Допполе для шины

**Таблица:** gsProductData

**Поля:**
- `number_shina` (varchar 191) - Шина

## Интеграция с gtsShop

Система также интегрирована с модулем gtsShop через следующие таблицы:

### gsAddField
Аналогичная структура полей для gtsShop с дополнительными параметрами:
- `config_id` - ID конфигурации
- `group_id` - ID группы
- `gts_config` - конфигурация для gtsShop
- `gts_config_select` - конфигурация выбора

### gsAddFieldConfig
Конфигурации для различных целей:
1. RaschetParamConfig для добавления gsParam в табл расчета
2. Допполя продукта для импорта из эксель
3. Допполя в таблицу gsParam для импорта из эксель
4. Допполя параметров продукта для импорта из эксель

### gsAddFieldGroup
Группы полей:
- `excel_add_fields` - Эксель

### gsAddFieldConfigLink
Связь конфигураций с таблицами:
- config_id 2 → gsProductData
- config_id 3 → gsParam
- config_id 4 → gsProductParam

### gsAddFieldGTS
Интеграция с интерфейсом gtsShop:
- Формы (gsmaked)
- Таблицы (gsParam)

### gsProductGroup
Группы продуктов:
1. Прямоугольное сечение
2. Круглое сечение

## Типы полей

### Базовые типы данных:
- `tinyint` - малое целое число
- `int` - целое число
- `varchar` - строка переменной длины
- `text` - текст

### Типы полей форм:
- `select` - выпадающий список
- `text` - текстовое поле
- `number` - числовое поле
- `boolean` - чекбокс

## Особенности конфигурации

### Поле properties
Поле `properties` содержит дополнительные данные в формате JSON для расширенной конфигурации поля. Может включать:
- Настройки валидации
- Дополнительные параметры отображения
- Специфичные для поля конфигурации
- Метаданные для интеграции с другими системами

### Поле sech_id (Сечение)
```javascript
"gtsapi_config": {
    "select_data": [
        {'id': 1, 'name': 'Прямоуголка'}, 
        {'id': 2, 'name': 'Кругляк'}
    ],
}
```

### Поле flanec (Фланец)
```javascript
"gts_config": {
    "edit": {
        "type": "checkbox"
    }
}
```

## Применение

Система используется для:
1. **Импорта из Excel** - дополнительные поля для обработки данных из Excel файлов
2. **Классификации продуктов** - поля для определения типа сечения, материалов
3. **Интеграции с внешними системами** - поля для связи с modx.pl и camduct
4. **Расширения функциональности** - добавление новых характеристик без изменения основной схемы

## Преимущества системы

1. **Гибкость** - возможность добавления новых полей без изменения кода
2. **Модульность** - группировка полей по функциональному назначению
3. **Совместимость** - интеграция с существующими модулями gtsShop и gtsAPI
4. **Масштабируемость** - легкое добавление новых групп и полей
